stages:
  - test

# =======================
#     TEST DE CYPRESS 01
# =======================
cypress_01_tests:
  stage: test
  image: cypress/browsers:node18.12.0-chrome103-ff107
  script:
    - cd "cypress/01_sencillo"
    - npm install --unsafe-perm
    - npx cypress verify
    - echo "Running Cypress tests for carpeta 01"
    - npx cypress run --browser electron
    - echo "Cypress tests finished."
  artifacts:
    expire_in: 1 week
    when: always
    paths:
      - cypress/videos
      - cypress/screenshots

# =======================
#     TEST DE CYPRESS 02
# =======================
cypress_02_tests:
  stage: test
  image: cypress/browsers:node18.12.0-chrome103-ff107
  script:
  - cd "cypress/02_POM"
  - npm install --unsafe-perm
  - chmod +x node_modules/.bin/cypress
  - npx --unsafe-perm cypress verify
  - echo "Running Cypress tests"
  - npx --unsafe-perm cypress run --browser electron
  - echo "Cypress tests finished."
  artifacts:
    expire_in: 1 week
    when: always
    paths:
      - cypress/videos
      - cypress/screenshots

# =======================
#     TEST DE CYPPRESS 03
# =======================
cypress_03_tests:
  stage: test
  image: cypress/browsers:node18.12.0-chrome103-ff107
  script:
    - cd "cypress/03_POMcucumber"
    - npm install --unsafe-perm
    - npx cypress verify
    - echo "Running Cypress tests for carpeta 03 (POM + Cucumber)"
    - npx cypress run --browser electron
    - echo "Cypress tests finished."
  artifacts:
    expire_in: 1 week
    when: always
    paths:
      - cypress/videos
      - cypress/screenshots

# =======================
#     TEST DE POSTMAN
# =======================
postman_tests:
  stage: test
  image:
    name: postman/newman:latest
    entrypoint: [""]
  script:
    - cd "ejercicios-API-con-postman"
    - echo "Running Postman collection"
    - newman run collection.json